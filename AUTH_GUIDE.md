# نظام التسجيل والمصادقة - دليل الاستخدام

## نظرة عامة

تم إضافة نظام تسجيل دخول متكامل يستخدم **Supabase** للمصادقة وتخزين البيانات. هذا يسمح للمستخدمين بـ:

- إنشاء حسابات جديدة باستخدام البريد الإلكتروني وكلمة المرور
- تسجيل الدخول والخروج
- حفظ واستيراد الشخصيات والمحادثات تلقائياً من السحابة
- الوصول إلى بيانات الحساب من أي جهاز

## كيفية الاستخدام

### تسجيل حساب جديد

1. اضغط على زر **Sign In** (أيقونة تسجيل الدخول) في الزاوية العلوية اليمنى من الشاشة
2. اختر **"Don't have an account? Create one"**
3. أدخل:
   - بريدك الإلكتروني
   - كلمة مرور قوية (6 أحرف على الأقل)
   - تأكيد كلمة المرور
4. اضغط **Create Account**

### تسجيل الدخول

1. اضغط على زر **Sign In** في الزاوية العلوية اليمنى
2. أدخل بريدك الإلكتروني وكلمة مرورك
3. اضغط **Sign In**
4. سيتم تحميل جميع شخصياتك ومحادثاتك تلقائياً

### تسجيل الخروج

1. اضغط على أيقونة **Log Out** في الزاوية العلوية اليمنى (ستظهر بعد تسجيل الدخول)
2. اضغط **Sign Out** في النافذة المنبثقة

## ما الذي يتم حفظه؟

عند تسجيل الدخول، يتم حفظ تلقائياً:

- **الشخصيات**: جميع الشخصيات التي أنشأتها (الأسماء، الأوصاف، الصور، إلخ)
- **المحادثات**: جميع جلسات الدردشة مع كل شخصية
- **الرسائل**: جميع الرسائل في كل محادثة
- **الإعدادات**: جميع إعدادات التطبيق الخاصة بك

## المزامنة التلقائية

- يتم حفظ البيانات تلقائياً بعد **ثانيتين** من إجراء أي تغيير
- يتم أيضاً حفظ البيانات محلياً في متصفحك كنسخة احتياطية
- في حالة عدم وجود اتصال بالإنترنت، يتم الحفظ محلياً تلقائياً

## الميزات الأمان

### تشفير البيانات

- جميع البيانات مشفرة أثناء الإرسال (HTTPS)
- يتم استخدام سياسات **Row Level Security (RLS)** في قاعدة البيانات
- كل مستخدم يرى فقط بيانات حسابه الخاص

### سياسات الوصول

- **المستخدمون المسجلون فقط** يمكنهم رؤية بيانات حسابهم
- **لا يمكن** لأي مستخدم رؤية بيانات مستخدم آخر
- لا يمكن حذف أو تعديل البيانات إلا من قبل صاحب الحساب

## الهندسة المعمارية

### جداول قاعدة البيانات

```
user_profiles
├── id (UUID)
├── email (TEXT)
├── created_at
└── updated_at

characters
├── id (UUID)
├── user_id (FK)
├── name, description, personality, ...
├── lorebooks (JSONB)
├── created_at
└── updated_at

chat_sessions
├── id (UUID)
├── user_id (FK)
├── character_id (FK)
├── name, summary
├── created_at
└── updated_at

chat_messages
├── id (TEXT)
├── session_id (FK)
├── user_id (FK)
├── role ('user' | 'model')
├── content
├── timestamp
└── created_at

user_settings
├── user_id (FK - PRIMARY KEY)
├── settings_data (JSONB)
└── updated_at
```

### الخدمات

1. **supabaseClient.ts** - إعداد عميل Supabase
2. **authService.ts** - إدارة المصادقة (Sign Up, Sign In, Sign Out)
3. **dataService.ts** - حفظ وتحميل البيانات من قاعدة البيانات
4. **AuthModal.tsx** - واجهة تسجيل الدخول والتسجيل

## التوافق مع Vercel

التطبيق متوافق بنسبة 100% مع **Vercel**:

- ✅ لا توجد متغيرات بيئة معقدة (Supabase سحابي)
- ✅ لا توجد خوادم Node.js مطلوبة
- ✅ جميع المكتبات مدعومة بشكل كامل
- ✅ لا توجد مشاكل CORS (Supabase يتعامل معها)

### نشر على Vercel

```bash
# 1. ادفع الكود إلى GitHub
git push origin main

# 2. اربط مع Vercel
# - اذهب إلى https://vercel.com
# - اختر "New Project"
# - اختر مستودعك على GitHub

# 3. أضف متغيرات البيئة:
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

## استكشاف الأخطاء

### "الشخصيات لم تُحمل"

- تحقق من الاتصال بالإنترنت
- افتح **Console** (F12) وابحث عن رسائل الخطأ
- جرب تسجيل الخروج والدخول مرة أخرى

### "لا يمكن تسجيل الدخول"

- تأكد من أن البريد الإلكتروني وكلمة المرور صحيحة
- تحقق من أن بريدك الإلكتروني يستخدم نفس الحساب المسجل
- حاول استخدام متصفح مختلف

### "البيانات لم تُحفظ"

- تحقق من الاتصال بالإنترنت
- تأكد من أنك مسجل دخول
- افتح **Network Tab** في Developer Tools لتحقق من الطلبات

## الخطوات التالية

### ميزات يمكن إضافتها:

- استرجاع كلمة المرور المنسية
- المصادقة متعددة العوامل (2FA)
- مشاركة الشخصيات مع مستخدمين آخرين
- النسخ الاحتياطية والاستعادة
- تصدير/استيراد البيانات

## الدعم التقني

إذا واجهت أي مشاكل:

1. افتح **Developer Console** (F12)
2. انسخ رسائل الخطأ
3. تحقق من تبويب **Network** لرؤية الطلبات الفاشلة
4. تحقق من أن Supabase يعمل بشكل صحيح
